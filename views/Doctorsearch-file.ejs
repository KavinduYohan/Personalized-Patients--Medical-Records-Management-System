<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
      <style>
            /* CSS styles for the user profile */
/* Global Styles */
body {
  font-family: Arial, sans-serif;
  background-color: #f0f0f0;
  margin: 0;
  padding: 0;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  box-sizing: border-box;
}

/* Header */
header {
  background-color: #4caf50;
  color: white;
  text-align: center;
  padding: 20px 0;
  margin-bottom: 20px;
}

/* Search Button */
form {
  text-align: center;
}

.btn-search {
  background-color: #2196f3;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

/* User Profile Details */
.user-profile {
  margin-bottom: 30px;
  background-color: #fff;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  border-radius: 10px;
  padding: 20px;
}

.user-profile h2 {
  text-align: center;
  margin-bottom: 20px;
}

.user-profile-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  max-width: 800px;
}

.user-profile-details > div {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
  background-color: #f9f9f9;
}

.user-profile-details label {
  font-weight: bold;
}

.user-profile-details p {
  margin-top: 5px;
}

/* User Medical Records */
.user-medical-records {
  margin-bottom: 30px;
  background-color: #fff;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  border-radius: 10px;
  padding: 20px;
}

.user-medical-records h2 {
  text-align: center;
  margin-bottom: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

table th,
table td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

table th {
  background-color: #f2f2f2;
}
/* Apply colors to alternate table rows */
.table tbody tr.even {
  background-color: #f0f8ff; /* Light blue */
}

.table tbody tr.odd {
  background-color: #ffe4e1; /* Light coral */
}
/* Table styles */
.table {
  width: 100%;
  border-collapse: collapse;
}

.table th,
.table td {
  padding: 10px;
  text-align: left;
}

/* Table header styles */
.table thead {
  background-color: #f5f5f5; /* Light gray */
}

.table th {
  font-weight: bold;
  color: #333; /* Dark gray */
}

/* Table body styles */
.table tbody tr.even {
  background-color: #f0f8ff; /* Light blue */
}

.table tbody tr.odd {
  background-color: #ffe4e1; /* Light coral */
}

/* Hover effect */
.table tbody tr:hover {
  background-color: #f9f9f9; /* Lighter gray on hover */
}

/* Add more styles or adjust these styles according to your preference */


      </style>
<link rel="stylesheet" type="text/css" href="../css/bootstrap.css">
<link href="../css/dataTables.bootstrap4.min.css" rel="stylesheet">
<link rel="../stylesheet" type="text/css" href="css/design.css">


<script src="../js/jquery.min.js"></script>
<script src="../js/jquery.dataTables.min.js"></script>
<script src="../js/dataTables.bootstrap4.min.js"></script>

</head>

<body>
    <nav class="py-1 navbar navbar-expand-lg navbar-light bg-danger">
        <a class="navbar-brand text-white ml-4" href="/doctor"><b>Search Patient</b></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">

            <div class="mr-5">
                <ul class="navbar-nav mr-auto mr-0">

                    <!-- <li class="nav-item">
                        <a class="nav-link text-white" href="/addfiles">Add new Record</b></a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link text-white" href="/search">Search</a>
                    </li> -->
                   
                </ul>
            </div>

        </div>
    </nav>


      <title>Patient Management System</title>
      
      <div class="container mt-5 w-50">
         <h2 class="mb-4">Search Patient</h2>
        
         <form action='/searchByEmail' method="get"> <!-- Updated form action -->
            <input type="email" name="email" class="form-control" placeholder="Email">
            <button type="submit" class="btn btn-danger btn-block mt-3">Search</button>
         </form>
         <% if (empData.length > 0) { %>
   
      
    
            <% empData.forEach(data => { %>
               <div class="user-profile">
                  <h2>User Profile Details</h2>
                  <div class="user-profile-details">
                      <div>
                          <label>Full Name:</label>
                          <p><%= data.fullName %></p>
                      </div>
                      <div>
                          <label>Email:</label>
                          <p><%= data.patientId.email %></p>
                      </div>
                      <div>
                          <label>Age:</label>
                          <p><%= data.age || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Date of Birth:</label>
                          <p><%= data.dob.toISOString().split('T')[0] %></p>
                      </div>
                      <div>
                          <label>NIC:</label>
                          <p><%= data.nic || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Civil Status:</label>
                          <p><%= data.civilStatus || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Gender:</label>
                          <p><%= data.gender || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Religion:</label>
                          <p><%= data.religion || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Occupation:</label>
                          <p><%= data.occupation || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Address:</label>
                          <p><%= data.address || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Mobile No:</label>
                          <p><%= data.mobileNo || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Birth Place:</label>
                          <p><%= data.birthPlace || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Blood Group:</label>
                          <p><%= data.bloodGroup || 'N/A' %></p>
                      </div>
                      <div>
                          <label>Profile Picture:</label>
                          <% if (data.profilePic) { %>
                              <img src="/upload/<%= data.profilePic %>" alt="Profile Picture" style="max-width: 100px; max-height: 100px;">
                          <% } else { %>
                              <p>No profile picture uploaded</p>
                          <% } %>
                      </div>
                  </div>
              </div>
               
                
                    
                 
               
            <% }); %>
          </tbody>
        </table>
      <% } else { %>
        <p>No data found for this patient.</p>
      <% } %>


      <h2>User Medical Details</h2>

      <% if (empprofile.length > 0) { %>
         <div class="container mt-5">
            <table >
            <thead>
              <tr>
                <div class="col-sm-12">
                  <table class="table table-bordered dataTable no-footer" id="dataTable" width="100%" cellspacing="0" role="grid" aria-describedby="dataTable_info" style="width: 100%;">
                <thead>
                   <tr role="row"><th class="sorting_asc" tabindex="0" aria-controls="dataTable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending" style="width: 46.2px;">
                     Date
                  </th>
                <th>Doctor Specialization</th>
                <th>Doctor name</th>
                <th>Prescription Photo</th>
                <th>Description</th>
                <th></th> 
              </tr>
            </thead>
            <tbody>
         <% empprofile.forEach(data => { %>
            <tr role="row" class="even">
              <td class="sorting_1"><%= data.appointment_date.toISOString().split('T')[0]  %></td> <!-- Assuming name is a field in patientRegister model -->
              <td><%= data.pname %></td>
              <td><%= data.doctor_name%></td>
              <td>
                <% if (data.prescriptionPhoto) { %>
                  <!-- Display image if prescriptionPhoto is present -->
                  <a href="#" data-bs-toggle="modal" data-bs-target="#imageModal" onclick="updateModalImage('/upload/<%= data.prescriptionPhoto %>')">
                    <img src="/upload/<%= data.prescriptionPhoto %>" alt="Prescription Photo" style="max-width: 100px; max-height: 100px;">
                  </a>
                <% } else { %>
                  <!-- Display a placeholder or leave it empty if no photo is present -->
                  No Photo
                <% } %>
              </td>
              
              <!-- Modal -->
              <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="imageModalLabel">Prescription Photo</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <img id="modalImage" src="" alt="Prescription Photo" style="max-width: 100%;">
                    </div>
                  </div>
                </div>
              </div>


              
              <td><%= data.description %></td>
              <td>
                
              </td>
            </tr>
          <% }); %>
      </div>
      <% } else { %>
         <p>No data found for this patient.</p>
       <% } %>
      

       <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
       <script>
         function updateModalImage(imageUrl) {
           var modalImage = document.getElementById('modalImage');
           modalImage.src = imageUrl;
         }
       </script>
     

       <script>

      // Select the <style> element or create a new one
// Select the search button and apply styles
const searchButton = document.querySelector('.btn-search');
searchButton.style.marginTop = '20px'; // Adjust top margin
searchButton.style.fontSize = '16px'; // Adjust font size
searchButton.style.fontWeight = 'bold'; // Adjust font weight
searchButton.style.textTransform = 'uppercase'; // Transform text to uppercase
searchButton.style.width = '200px'; // Adjust width

// Additional styles for table rows in medical records
const tableRows = document.querySelectorAll('.user-medical-records tbody tr');
tableRows.forEach(row => {
  row.style.backgroundColor = '#f9f9f9'; // Background color
  row.style.transition = 'background-color 0.3s ease'; // Transition effect on hover
  row.addEventListener('mouseenter', () => {
    row.style.backgroundColor = '#e0e0e0'; // Change background color on hover
  });
  row.addEventListener('mouseleave', () => {
    row.style.backgroundColor = '#f9f9f9'; // Revert background color on mouse leave
  });
});

   

       </script>
<%- include('common/footer') %>


